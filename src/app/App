import React from "react";
import {TaskWrapper} from "./taskwrapper.js";
import {bindActionCreators} from "redux";
import {connect} from "react-redux";
import {setTaskAction} from "./actions/task.actions";
import PropTypes from 'prop-types';


export class App extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            inputData : '',
            tasks: {},
        };
    }

    onInputChange = (e) => {
        this.setState({inputData: e.target.value})
    };


    onClickHandler = (e) => {
        e.preventDefault();
        this.setState({tasks: {}});

    };

    onClickHandlerDone = (e) => {
        e.preventDefault();
        let tasks = {...this.state.tasks};
        Object.values(this.state.tasks).map((task) => {
            if (task.checked) {
                delete tasks[task.id]
            }
        });
        this.setState({tasks});
    };


    onCheckClick = (taskId) => {
        const task = {...this.state.tasks[taskId]};
        const checkedTask = {...task, checked: !task.checked};
        this.setState({tasks:{...this.state.tasks, [taskId]: checkedTask}});
    };

    onCleanClick = (taskId) => {
        const tasks = {...this.state.tasks};
        delete tasks[taskId];
        this.setState({tasks});
        console.log (taskId)
    };

    onClickHandlerAdd = (e) => {
        e.preventDefault();
        const taskId = Math.random().toString(20).substring(2);
        const newTask = {id: taskId, title: this.state.inputData, checked: false};
        //this.setState({tasks: {...this.state.tasks, [taskId]: newTask}, inputData:''});
        this.props.setTaskAction(this.state.inputData)
    };


    render()
    {
        return (
            <div>
                <form>
                    <label>
                        <button onClick={this.onClickHandler}>CLEAN ALL</button>
                        <button onClick={this.onClickHandlerDone}>CLEAN DONE</button>
                        <input value={this.state.inputData} onChange={this.onInputChange}/>
                        <button onClick={this.onClickHandlerAdd}>ADD </button>
                    </label>
                </form>
                <TaskWrapper onCheckClick={this.onCheckClick} onCleanClick={this.onCleanClick}
                             tasks={this.state.tasks}/>
            </div>
        )
    }
}

App.propTypes = {
    setTaskAction: PropTypes.func.isRequired,
    tasks: PropTypes.object
};

//mapping of state to component props - data from store -> props
const mapStateToProps = (state) => ({
    tasks: state.tasks.byId,
});

//maps actions to props
const mapDispatchToProps = (dispatch) => bindActionCreators({
    setTaskAction
}, dispatch);

// connects mapStateToProps and mapDispatchToProps to this component
export default connect(mapStateToProps, mapDispatchToProps)(App);